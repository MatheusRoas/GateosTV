<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ± GateosTV</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
}
header {
  background: #111;
  color: #e53935;
  text-align: center;
  padding: 12px;
  font-size: 18px;
  font-weight: bold;
}
main {
  padding: 10px;
}
input, button {
  width: 100%;
  padding: 10px;
  margin: 6px 0;
  background: #222;
  color: #fff;
  border: 1px solid #333;
}
button {
  cursor: pointer;
  background: #e53935;
  border: none;
}
video {
  width: 100%;
  max-height: 40vh;
  background: #000;
}
.channel {
  padding: 10px;
  border-bottom: 1px solid #222;
  cursor: pointer;
}
.channel:hover {
  background: #111;
}
small {
  color: #aaa;
}
</style>
</head>

<body>

<header>
  ğŸ± GateosTV â€” Reprodutor M3U
</header>

<main>
  <small>
    ğŸ‡§ğŸ‡· Envie um arquivo M3U ou cole um link<br>
    ğŸ‡ªğŸ‡¸ Sube un archivo M3U o pega un enlace
  </small>

  <input type="file" id="fileInput" accept=".m3u,.m3u8">
  <input type="text" id="urlInput" placeholder="Cole aqui o link da lista M3U">
  <button onclick="carregarLink()">Carregar Lista</button>

  <video id="video" controls></video>

  <div id="lista"></div>
</main>

<script>
const PROXY = "https://gateostv-proxy.onrender.com";
const video = document.getElementById("video");
let hls = null;

// Tocar canal
function tocar(url) {
  const finalUrl = PROXY + encodeURIComponent(url);

  if (hls) {
    hls.destroy();
    hls = null;
  }

  if (Hls.isSupported()) {
    hls = new Hls();
    hls.loadSource(finalUrl);
    hls.attachMedia(video);
  } else {
    video.src = finalUrl;
  }
}

// Ler M3U
function parseM3U(texto) {
  const linhas = texto.split("\n");
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  let nome = "";

  linhas.forEach(l => {
    l = l.trim();
    if (l.startsWith("#EXTINF")) {
      nome = l.split(",").pop();
    } else if (l.startsWith("http")) {
      const div = document.createElement("div");
      div.className = "channel";
      div.textContent = nome || "Canal";
      div.onclick = () => tocar(l);
      lista.appendChild(div);
    }
  });
}

// Upload arquivo
document.getElementById("fileInput").addEventListener("change", e => {
  const reader = new FileReader();
  reader.onload = ev => parseM3U(ev.target.result);
  reader.readAsText(e.target.files[0]);
});

// Carregar via link
function carregarLink() {
  fetch(document.getElementById("urlInput").value)
    .then(r => r.text())
    .then(parseM3U)
    .catch(() => alert("Erro ao carregar a lista"));
}
</script>

</body>
</html>
